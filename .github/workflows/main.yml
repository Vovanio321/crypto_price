name: Update Crypto Prices in Telegram (keep emojis)

on:
  workflow_dispatch:  # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∞

jobs:
  update-prices:
    runs-on: ubuntu-latest
    steps:
      - name: Update Prices Only
        run: |
          python3 - <<'EOF'
          import os
          import requests

          BOT_TOKEN = os.environ["TELEGRAM_BOT_TOKEN"]
          CHANNEL = os.environ["TELEGRAM_CHANNEL"]
          MESSAGE_ID = 8  # ID —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º

          # ID –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç Coinlore
          COINS = {"BTC": "90", "ETH": "80", "BNB": "2710"}

          # –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—ã
          def get_prices():
              url = f"https://api.coinlore.net/api/ticker/?id={','.join(COINS.values())}"
              resp = requests.get(url).json()
              return {coin["symbol"]: float(coin["price_usd"]) for coin in resp}

          def edit_message():
              prices = get_prices()
              # –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç, –æ—Å—Ç–∞–≤–ª—è—è —ç–º–æ–¥–∑–∏ –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
              text = f"ü§ë {prices['BTC']:.2f}$ ü§ë {prices['ETH']:.2f}$ ü§ë {prices['BNB']:.2f}$"
              payload = {
                  "chat_id": CHANNEL,
                  "message_id": MESSAGE_ID,
                  "text": text
              }
              r = requests.post(f"https://api.telegram.org/bot{BOT_TOKEN}/editMessageText", json=payload)
              print(r.text)

          if __name__ == "__main__":
              edit_message()
          EOF
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL: ${{ secrets.TELEGRAM_CHANNEL }}
